<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Adicionar usuário</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i&amp;display=swap">
    <link rel="stylesheet" href="assets/fonts/fontawesome-all.min.css">
    <link rel="stylesheet" href="assets/css/styles.min.css">
</head>

<body id="page-top" onload="validarSessao(), listarCaixas(), verificarCargo()">
    <span id="mensagem_erro" class="ms"></span>
    <div id="wrapper">
        <nav class="navbar navbar-dark align-items-start sidebar sidebar-dark accordion bg-gradient-primary p-0"
            style="background: rgb(0, 132, 156);">
            <div class="container-fluid d-flex flex-column p-0"><a
                    class="navbar-brand d-flex justify-content-center align-items-center sidebar-brand m-0" href="#">
                    <div class="sidebar-brand-icon"><img src="assets/img/logo/logoWhite.png" width="60%"
                            style="margin-top: 10%;"></div>
                </a>
                <hr class="sidebar-divider my-0">
                <ul id="accordionSidebar" class="navbar-nav text-light">
					<li class="nav-item"><a class="nav-link" href="listarUser.html" id="link_list_user"><i class="fas fa-user"></i><span>Lista de usuários</span></a><a class="nav-link active" href="addUser.html" id="link_add_user"><i class="fas fa-user-plus"></i><span>Adicionar Usuário</span></a><a class="nav-link" href="addCaixa.html" id="link_add_caixa"><i class="fas fa-server"></i><span>Cadastrar Caixa</span></a></li>
                    <li class="nav-item"><a id="link_dash" class="nav-link" data-bs-toggle="collapse" href="#div_caixas" role="button" aria-expanded="false" aria-controls="div_caixas"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a>
						<div class="collapse show" id="div_caixas">	
						</div>
					</li>
				</ul>
                <div class="text-center d-none d-md-inline"><button class="btn rounded-circle border-0"
                        id="sidebarToggle" type="button"></button></div>
            </div>
        </nav>
        <div class="d-flex flex-column" id="content-wrapper">
            <div id="content">
                <nav class="navbar navbar-light navbar-expand bg-white shadow mb-4 topbar static-top">
                    <div class="container-fluid">
                        <h5 style="color: var(--bs-navbar-brand-color);">Administrador</h5>
                        <ul class="navbar-nav flex-nowrap ms-auto">
                            <li class="nav-item dropdown no-arrow mx-1"></li>
                            <li class="nav-item dropdown no-arrow mx-1">
                                <div class="shadow dropdown-list dropdown-menu dropdown-menu-end"
                                    aria-labelledby="alertsDropdown"></div>
                            </li>
                            <div class="d-none d-sm-block topbar-divider"></div>
                            <li class="nav-item dropdown no-arrow">
                                <div class="nav-item dropdown no-arrow"><a class="dropdown-toggle nav-link"
                                        aria-expanded="false" data-bs-toggle="dropdown" href="#"><span
                                            class="d-none d-lg-inline me-2 text-gray-600 small" id="span_user">Kash User</span><svg
                                            xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"
                                            viewBox="0 0 24 24" fill="none" style="font-size: 33px;">
                                            <path
                                                d="M5.12104 17.8037C7.15267 16.6554 9.4998 16 12 16C14.5002 16 16.8473 16.6554 18.879 17.8037M15 10C15 11.6569 13.6569 13 12 13C10.3431 13 9 11.6569 9 10C9 8.34315 10.3431 7 12 7C13.6569 7 15 8.34315 15 10ZM21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z"
                                                stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                                stroke-linejoin="round"></path>
                                        </svg></a>
                                    <div class="dropdown-menu shadow dropdown-menu-end animated--grow-in"><a
                                            class="dropdown-item" onclick="limparSessao()"><i
                                                class="fas fa-sign-out-alt fa-sm fa-fw me-2 text-gray-400"></i>&nbsp;Sair</a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </nav>
                <div class="container-fluid">
                    <h3 class="text-dark mb-4">Adicionar um novo usuário</h3>
                    <div class="row mb-3">
                        <div class="col-auto col-lg-8 col-xl-12">
                            <div class="row mb-3 d-none">
                                <div class="col">
                                    <div class="card text-white bg-primary shadow">
                                        <div class="card-body">
                                            <div class="row mb-2">
                                                <div class="col">
                                                    <p class="m-0">Peformance</p>
                                                    <p class="m-0"><strong>65.2%</strong></p>
                                                </div>
                                                <div class="col-auto"><i class="fas fa-rocket fa-2x"></i></div>
                                            </div>
                                            <p class="text-white-50 small m-0"><i class="fas fa-arrow-up"></i>&nbsp;5%
                                                since last month</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="card text-white bg-success shadow">
                                        <div class="card-body">
                                            <div class="row mb-2">
                                                <div class="col">
                                                    <p class="m-0">Peformance</p>
                                                    <p class="m-0"><strong>65.2%</strong></p>
                                                </div>
                                                <div class="col-auto"><i class="fas fa-rocket fa-2x"></i></div>
                                            </div>
                                            <p class="text-white-50 small m-0"><i class="fas fa-arrow-up"></i>&nbsp;5%
                                                since last month</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-12 col-xl-12 offset-lg-3 offset-xl-0">
                                    <div class="card shadow mb-3">
                                        <div class="card-header py-3">
                                            <p class="text-primary m-0 fw-bold">Informações do usuário</p>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col">
                                                    <div class="mb-3"><label class="form-label"><strong>Nome</strong></label><input
                                                            class="form-control" type="text" id="ipt_nome_usuario"
                                                            placeholder="" name="nome_usuario"></div>
                                                </div>
                                                <div class="col">
                                                    <div class="mb-3"><label class="form-label"><strong>Email</strong></label><input
                                                            class="form-control" type="email" id="ipt_email_usuario"
                                                            placeholder="" name="email" inputmode="email"></div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-xl-6">
                                                    <div class="mb-3"><label class="form-label"><strong>Função</strong></label><select
                                                            class="form-select" id="select_cargo">
                                                            <option value="ger">Gerente</option>
                                                            <option value="tec">Técnico</option>
                                                        </select></div>
                                                </div>
                                                <div class="col-lg-5 col-xl-6">
                                                    <div class="mb-3"><label class="form-label"
                                                            for="last_name"><strong>Senha</strong><br></label><input
                                                            class="form-control" type="password" id="ipt_senha_usuario"
                                                            placeholder="" name="last_name"></div>
                                                </div>
                                            </div>
                                            <div class="text-center mb-3"><button class="btn btn-primary btn-sm"
                                                    style="margin-top: 2%;" onclick="cadastrar()">Cadastrar Usuário</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <footer class="bg-white sticky-footer">
                <div class="container my-auto">
                    <div class="text-center my-auto copyright"><span>Copyright © KASH+&nbsp;2022</span></div>
                </div>
            </footer>
        </div>
    </div>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/script.min.js"></script>
	<script src="../js/funcoes.js"></script>
</body>

</html>
<script>
    setTimeout(addListeners, 1000);


    function cadastrar() {
        //Recupere o valor da nova input pelo nome do id
        // Agora vá para o método fetch logo abaixo
        var nomeUserVar = ipt_nome_usuario.value;
        var emailUserVar = ipt_email_usuario.value;
        var senhaUserVar = ipt_senha_usuario.value;
        var cargoVar = select_cargo.value; 
        var cnpjVar = sessionStorage.BANCO_ID;
        var cadastroBanco = false;

        if(nomeUserVar == "" || emailUserVar == "" || senhaUserVar == "" ) {
            mensagem_erro.classList.add("alerta")
            mensagem_erro.style.display = "flex";
            mensagem_erro.innerHTML = "Por favor não deixe nenhum campo em branco";
            setTimeout(() => {
                mensagem_erro.style.display = "none";
                mensagem_erro.classList.remove("alerta");
                mensagem_erro.innerHTML = "";
            }, 5000)

            return false;
        }

        // Enviando o valor da nova input
        fetch("/usuarios/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                nomeServer: nomeUserVar,
                emailServer: emailUserVar,
                senhaServer: senhaUserVar,
                cargoServer: cargoVar,
                cnpjServer: cnpjVar,
                cadastroBanco: cadastroBanco
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                mensagem_erro.classList.add("ok");
                mensagem_erro.style.display = "flex";

                mensagem_erro.innerHTML = "Cadastro realizado com sucesso!";

                ipt_nome_usuario.value = "";
                ipt_email_usuario.value = "";

                setTimeout(() => {
                    mensagem_erro.style.display = "none";
                    mensagem_erro.classList.remove("ok");
                    mensagem_erro.innerHTML = "";
                    window.location.href = "./addUser.html";
                }, 5000)

            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
                mensagem_erro.classList.add("erro");
                mensagem_erro.style.display = "flex";

                mensagem_erro.innerHTML = "Houve um erro ao tentar realizr o cadastro!";

                setTimeout(() => {
                    mensagem_erro.style.display = "none";
                    mensagem_erro.classList.remove("erro");
                    mensagem_erro.innerHTML = "";
                }, 5000)
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });

        return false;
    }
</script>